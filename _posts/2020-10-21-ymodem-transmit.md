---
layout: mypost
title: Xshell/secureCRT Ymodem 发送文件笔记
categories: [编码笔记,Xshell,secureCRT]
---

> 使用 Xshell 和 secureCRT 发送文件的时候，发相同的文件，但是效果不太一样，所以使用逻辑分析仪抓了一下波形，记录一下。

## Xshell 记录

| Xshell | 方向 | Receiver | 说明 |
| :---: | :---: | :---: | :---: |
| 准备就绪 | 无 | 准备就绪 | |
|  | <--- | 'C' | 请求发送 |
| 0x72,0x62,0x20,0x2D,0x45,0x0D | ---> |  | 这是啥?字符串:rb -E\n |
|  | <--- | CAN | 无效数据,回复CAN,<br>或者忽略 |
|  | <--- | 'C' | 超时请求发送 |
| 0x01,0x00,0xFF,file_name,0x00,file_size,0x00,CRC,CRC | ---> |  | 发送文件名+文件大小 |
|  | <--- | ACK,'C' | 应答 |
| 0x01,0x01,0xFE,file_data,CRC,CRC | ---> |  | 文件数据 |
|  | <--- | ACK | 应答 |
| ... | ... | ... | ... |
| 0x01,SEQ,~SEQ,file_data,0x1A,...,CRC,CRC | ---> |  | 文件数据最后部分,不够128字节以0x1A填充 |
|  | <--- | ACK | 应答 |
| EOT  | ---> |  | 传输结束 |
|  | <--- | NAK | 拒绝接收 |
| EOT  | ---> |  | 传输结束 |
|  | <--- | ACK | 应答 |
|  | <--- | 'C' | 超时请求发送 |
| 0x01,0x00,0xFF,0x00,...,0x4F,0x4F | ---> |  | 结束帧数据包,这个校验不对?<br>或者不检验这最后一桢 |
|  | <--- | NAK | 拒绝接收,检验不通过,<br>或者直接回复ACK |
|  | <--- | 'C' | 超时请求发送,<br>或者可以直接退出了 |
| ... | ... | ... | Xshell传输界面依然保留,接收端超时退出,<br>或者可以直接退出了 |

## SecureCRT 记录

| SecureCRT | 方向 | Receiver | 说明 |
| :---: | :---: | :---: | :---: |
| 准备就绪 | 无 | 准备就绪 | |
|  | <--- | 'C' | 请求发送 |
| 0x01,0x00,0xFF,file_name,0x00,file_size,0x00,CRC,CRC | ---> |  | 发送文件名+文件大小 |
|  | <--- | ACK,'C' | 应答 |
| 0x01,0x01,0xFE,file_data,CRC,CRC | ---> |  | 文件数据 |
|  | <--- | ACK | 应答 |
| ... | ... | ... | ... |
| 0x01,SEQ,~SEQ,file_data,0x1A,...,CRC,CRC | ---> |  | 文件数据最后部分,不够128字节以0x1A填充 |
|  | <--- | ACK | 应答 |
| EOT  | ---> |  | 传输结束 |
|  | <--- | NAK | 拒绝接收 |
| EOT  | ---> |  | 传输结束 |
|  | <--- | ACK | 应答 |
|  | <--- | 'C' | 超时请求发送 |
| 0x01,0x00,0xFF,0x00,0x30,0x20,0x30,0x20,0x30,0x00,...,CRC,CRC | ---> |  | 结束帧数据包,这不是空包?不过检验是对的,<br>解析为字符串:0 0 0 |
|  | <--- | ACK | 应答,可以直接退出了 |

## 总结

1. Xshell:开头会发一串字符串:"rb -E\n";结束发送的空包校验值是:0x4F,0x4F,待重新确认Ymodem协议细节.
2. SecureCRT:结束发送的应该是空包,但是实际发送的数据包是一小段字符串:"0 0 0",待重新确认Ymodem协议细节.
