<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="A embedded programer">
<meta property="og:type" content="website">
<meta property="og:title" content="Lim&#39;s blog">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Lim&#39;s blog">
<meta property="og:description" content="A embedded programer">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Lin Yuanbo">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Lim's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Lim's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">sub blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/01/object-oriented-design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/01/object-oriented-design/" class="post-title-link" itemprop="url">面向对象设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-01T00:00:00+00:00">2021-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RTOS/" itemprop="url" rel="index"><span itemprop="name">RTOS</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>维基百科说明：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object-oriented_programming">面向对象设计</a></p>
<p>面向对象的三大特性：继承、封装、多态，虽然在重要的面向对象编程语言中没有C语言，但是很多代码实现中依然有面向对象设计的思想，以此记录一下学习笔记。</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>维基百科说明：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">继承</a></p>
<blockquote>
<p>继承（英语：inheritance）是面向对象软件技术当中的一个概念。如果一个类别B“继承自”另一个类别A，就把这个B称为“A的子类”，而把A称为“B的父类别”也可以称“A是B的超类”。继承可以使得子类具有父类别的各种属性和方法，而不需要再次编写相同的代码。在令子类别继承父类别的同时，可以重新定义某些属性，并重写某些方法，即覆盖父类别的原有属性和方法，使其获得与父类别不同的功能。另外，为子类追加新的属性和方法也是常见的做法。 一般静态的面向对象编程语言，继承属于静态的，意即在子类的行为在编译期就已经决定，无法在运行期扩展。</p>
<p>有些编程语言支持多重继承，即一个子类可以同时有多个父类，比如C++编程语言；而在有些编程语言中，一个子类只能继承自一个父类，比如Java编程语言，这时可以透过实现接口来实现与多重继承相似的效果。</p>
<p>现今面向对象程序设计技巧中，继承并非以继承类别的“行为”为主，而是继承类别的“类型”，使得组件的类型一致。另外在设计模式中提到一个守则，“多用合成，少用继承”，此守则也是用来处理继承无法在运行期动态扩展行为的遗憾。</p>
</blockquote>
<p>个人理解：假设有两个相似数据结构，把他们共同的地方抽象出来作为基类，原来两个相似的数据结构包着这个基类数据结构，那么就是简单的继承了，以下是 rt-thread 的实现，多种通信方式都继承了 <code>struct rt_ipc_object</code> 这个数据结构。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_object</span> <span class="title">parent</span>;</span>                            <span class="comment">/**&lt; inherit from rt_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_list_t</span>        suspend_thread;                    <span class="comment">/**&lt; threads pended on this resource */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_semaphore</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span> <span class="title">parent</span>;</span>                        <span class="comment">/**&lt; inherit from ipc_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          value;                         <span class="comment">/**&lt; value of semaphore. */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          reserved;                      <span class="comment">/**&lt; reserved field */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span> <span class="title">parent</span>;</span>                        <span class="comment">/**&lt; inherit from ipc_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          value;                         <span class="comment">/**&lt; value of mutex */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint8_t</span>           original_priority;             <span class="comment">/**&lt; priority of last thread hold the mutex */</span></span><br><span class="line">    <span class="keyword">rt_uint8_t</span>           hold;                          <span class="comment">/**&lt; numbers of thread hold the mutex */</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_thread</span>    *<span class="title">owner</span>;</span>                         <span class="comment">/**&lt; current owner of mutex */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_event</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span> <span class="title">parent</span>;</span>                        <span class="comment">/**&lt; inherit from ipc_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint32_t</span>          <span class="built_in">set</span>;                           <span class="comment">/**&lt; event set */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_mailbox</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span> <span class="title">parent</span>;</span>                        <span class="comment">/**&lt; inherit from ipc_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_ubase_t</span>          *msg_pool;                      <span class="comment">/**&lt; start address of message buffer */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          size;                          <span class="comment">/**&lt; size of message pool */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          entry;                         <span class="comment">/**&lt; index of messages in msg_pool */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          in_offset;                     <span class="comment">/**&lt; input offset of the message buffer */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          out_offset;                    <span class="comment">/**&lt; output offset of the message buffer */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_list_t</span>            suspend_sender_thread;         <span class="comment">/**&lt; sender thread suspended on this mailbox */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_messagequeue</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_ipc_object</span> <span class="title">parent</span>;</span>                        <span class="comment">/**&lt; inherit from ipc_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span>                *msg_pool;                      <span class="comment">/**&lt; start address of message queue */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          msg_size;                      <span class="comment">/**&lt; message size of each message */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          max_msgs;                      <span class="comment">/**&lt; max number of messages */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>          entry;                         <span class="comment">/**&lt; index of messages in the queue */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span>                *msg_queue_head;                <span class="comment">/**&lt; list head */</span></span><br><span class="line">    <span class="keyword">void</span>                *msg_queue_tail;                <span class="comment">/**&lt; list tail */</span></span><br><span class="line">    <span class="keyword">void</span>                *msg_queue_free;                <span class="comment">/**&lt; pointer indicated the free node of queue */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_list_t</span>            suspend_sender_thread;         <span class="comment">/**&lt; sender thread suspended on this message queue */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>维基百科说明：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">封装</a></p>
<blockquote>
<p>在面向对象编程方法中，封装（英语：Encapsulation）是指，一种将抽象性函数接口的实现细节部分包装、隐藏起来的方法。同时，它也是一种防止外界调用端，去访问对象内部实现细节的手段，这个手段是由编程语言本身来提供的。封装被视为是面向对象的四项原则之一。</p>
<p>适当的封装，可以将对象使用接口的程序实现部分隐藏起来，不让用户看到，同时确保用户无法任意更改对象内部的重要资料，若想接触资料只能通过公开接入方法（Publicly accessible methods）的方式（ 如：”getters” 和”setters”）。它可以让代码更容易理解与维护，也加强了代码的安全性。</p>
</blockquote>
<p>个人理解：内核中的原子操作具体实现如下（32位x86平台下atomic API在arch/x86/include/asm/atomic_32.h中实现），虽然C语言没有 private 的结构体成语描述方法，但是在原子操作中，应该也没有人直接访问结构体成员，而是通过系统的接口进行原子操作，具体实现如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> counter; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">atomic_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATOMIC_INIT(i) &#123; (i) &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">atomic_read</span><span class="params">(<span class="keyword">const</span> <span class="keyword">atomic_t</span> *v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v-&gt;counter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">atomic_set</span><span class="params">(<span class="keyword">atomic_t</span> *v, <span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    v-&gt;counter = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><p>维基百科说明：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Polymorphism_(computer_science)">多态</a></p>
<blockquote>
<p>在编程语言和类型论中，多态（英语：polymorphism）指为不同数据类型的实体提供统一的接口，或使用一个单一的符号来表示多个不同的类型。</p>
</blockquote>
<p>个人理解：各种不同的继承者，调用他们各自不通的实现方式，以 rt-thread 中设备框架模型作为理解，代码实现如下：</p>
<p>所有的设备的基类 <code>struct rt_device</code>， 串行数据设备 <code>struct rt_serial_device</code>， I2C总线设备 <code>struct rt_i2c_bus_device</code>， SPI总线设备 <code>struct rt_spi_bus</code>，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_device</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_object</span>          <span class="title">parent</span>;</span>                   <span class="comment">/**&lt; inherit from rt_object */</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">rt_device_class_type</span> <span class="title">type</span>;</span>                     <span class="comment">/**&lt; device type */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>               flag;                     <span class="comment">/**&lt; device flag */</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>               open_flag;                <span class="comment">/**&lt; device open flag */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">rt_uint8_t</span>                ref_count;                <span class="comment">/**&lt; reference count */</span></span><br><span class="line">    <span class="keyword">rt_uint8_t</span>                device_id;                <span class="comment">/**&lt; 0 - 255 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* device call back */</span></span><br><span class="line">    <span class="keyword">rt_err_t</span> (*rx_indicate)(<span class="keyword">rt_device_t</span> dev, <span class="keyword">rt_size_t</span> size);</span><br><span class="line">    <span class="keyword">rt_err_t</span> (*tx_complete)(<span class="keyword">rt_device_t</span> dev, <span class="keyword">void</span> *buffer);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> RT_USING_DEVICE_OPS</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_device_ops</span> *<span class="title">ops</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="comment">/* common device interface */</span></span><br><span class="line">    <span class="keyword">rt_err_t</span>  (*init)   (<span class="keyword">rt_device_t</span> dev);</span><br><span class="line">    <span class="keyword">rt_err_t</span>  (*open)   (<span class="keyword">rt_device_t</span> dev, <span class="keyword">rt_uint16_t</span> oflag);</span><br><span class="line">    <span class="keyword">rt_err_t</span>  (*close)  (<span class="keyword">rt_device_t</span> dev);</span><br><span class="line">    <span class="keyword">rt_size_t</span> (*read)   (<span class="keyword">rt_device_t</span> dev, <span class="keyword">rt_off_t</span> pos, <span class="keyword">void</span> *buffer, <span class="keyword">rt_size_t</span> size);</span><br><span class="line">    <span class="keyword">rt_size_t</span> (*write)  (<span class="keyword">rt_device_t</span> dev, <span class="keyword">rt_off_t</span> pos, <span class="keyword">const</span> <span class="keyword">void</span> *buffer, <span class="keyword">rt_size_t</span> size);</span><br><span class="line">    <span class="keyword">rt_err_t</span>  (*control)(<span class="keyword">rt_device_t</span> dev, <span class="keyword">int</span> cmd, <span class="keyword">void</span> *args);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(RT_USING_POSIX)</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">dfs_file_ops</span> *<span class="title">fops</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_wqueue</span> <span class="title">wait_queue</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span>                     *user_data;                <span class="comment">/**&lt; device private data */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_serial_device</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_device</span>          <span class="title">parent</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_uart_ops</span> *<span class="title">ops</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">serial_configure</span>   <span class="title">config</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *serial_rx;</span><br><span class="line">    <span class="keyword">void</span> *serial_tx;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_i2c_bus_device</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_device</span> <span class="title">parent</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_i2c_bus_device_ops</span> *<span class="title">ops</span>;</span></span><br><span class="line">    <span class="keyword">rt_uint16_t</span>  flags;</span><br><span class="line">    <span class="keyword">rt_uint16_t</span>  addr;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">lock</span>;</span></span><br><span class="line">    <span class="keyword">rt_uint32_t</span>  timeout;</span><br><span class="line">    <span class="keyword">rt_uint32_t</span>  retries;</span><br><span class="line">    <span class="keyword">void</span> *priv;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rt_spi_bus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_device</span> <span class="title">parent</span>;</span></span><br><span class="line">    <span class="keyword">rt_uint8_t</span> mode;</span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_spi_ops</span> *<span class="title">ops</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">lock</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_spi_device</span> *<span class="title">owner</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 rt-thread 中，虽然应用层调用一样的方法，但是因为数据结构的不一样，他对于底层实现的方法也不一样，所以实现的功能也不一样，使用方法顺序如下：</p>
<ol>
<li>通过寻找设备句柄 <code>rt_device_t rt_device_find(const char* name);</code>；</li>
<li>打开设备 <code>rt_err_t rt_device_open(rt_device_t dev, rt_uint16_t oflags);</code>；</li>
<li>控制设备 <code>rt_err_t rt_device_control(rt_device_t dev, rt_uint8_t cmd, void* arg);</code>；</li>
<li>关闭设备 <code>rt_err_t rt_device_close(rt_device_t dev);</code>；</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/stm32-upgrade/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/stm32-upgrade/" class="post-title-link" itemprop="url">STM32 的三种升级方式比较与记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-02-08T00:00:00+00:00">2021-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MISC/" itemprop="url" rel="index"><span itemprop="name">MISC</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>目前STM32最常用的升级基本都是将新的固件下载到下载区域，然后下次重启在BOOTLOADER进行搬运。</p>
<p>由于公司产品按键开机的供电电路是短暂供电的，需要在应用中使能供电，所以升级重启之后用户需要长按几秒才能正常升级和开机，造成使用困扰，所以只能思考尝试有没有其他的方法。</p>
</blockquote>
<h2 id="方式一（目前最常用的方式）"><a href="#方式一（目前最常用的方式）" class="headerlink" title="方式一（目前最常用的方式）"></a>方式一（目前最常用的方式）</h2><h3 id="方式一分区表"><a href="#方式一分区表" class="headerlink" title="方式一分区表"></a>方式一分区表</h3><table>
<thead>
<tr>
<th align="center">分区名称</th>
<th align="center">分区大小</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">bootloader</td>
<td align="center">自定义</td>
<td align="center">引导区</td>
</tr>
<tr>
<td align="center">data</td>
<td align="center">自定义</td>
<td align="center">数据区</td>
</tr>
<tr>
<td align="center">factory-firmware</td>
<td align="center">自定义</td>
<td align="center">出厂固件区</td>
</tr>
<tr>
<td align="center">iteration-firmware</td>
<td align="center">自定义</td>
<td align="center">迭代固件区</td>
</tr>
<tr>
<td align="center">download</td>
<td align="center">自定义</td>
<td align="center">固件下载区</td>
</tr>
</tbody></table>
<h3 id="方式一-Bootloader-工作流程"><a href="#方式一-Bootloader-工作流程" class="headerlink" title="方式一 Bootloader 工作流程"></a>方式一 Bootloader 工作流程</h3><div class="mermaid">
graph TD;
    startup-->check_data_area;
    check_data_area-->upgrade_flow;
    check_data_area-->goto_factory_fm;
    upgrade_flow-->check_download;
    check_download-->move_download_to_iteration;
    move_download_to_iteration-->check_iteration;
    check_iteration-->goto_iteration_fm;
</div>

<h3 id="方式一-upgrade-工作流程"><a href="#方式一-upgrade-工作流程" class="headerlink" title="方式一 upgrade 工作流程"></a>方式一 upgrade 工作流程</h3><div class="mermaid">
graph TD;
    upgrade_flow-->erase_download_area;
    erase_download_area-->receive_iteration_fm;
    receive_iteration_fm-->receive_finish;
    receive_finish-->check_iteration_fm;
    check_iteration_fm-->change_data_area;
    change_data_area-->response_success_or_fail;
    check_iteration_fm-->response_success_or_fail;
</div>

<h3 id="方式一-总结"><a href="#方式一-总结" class="headerlink" title="方式一 总结"></a>方式一 总结</h3><p>这种方式目前看问题不大，但是也是有缺点的：</p>
<ol>
<li>升级失败就直接回到出厂区运行了。</li>
<li>在程序较大的情况下，BOOTLOAD搬运的时间就比较长，在引言所说的情况下就不适合这种场景了。</li>
<li>需要额外的下载区，感觉有点浪费空间。</li>
</ol>
<h2 id="方式二（专用的升级区）"><a href="#方式二（专用的升级区）" class="headerlink" title="方式二（专用的升级区）"></a>方式二（专用的升级区）</h2><h3 id="方式二-分区表"><a href="#方式二-分区表" class="headerlink" title="方式二 分区表"></a>方式二 分区表</h3><table>
<thead>
<tr>
<th align="center">分区名称</th>
<th align="center">分区大小</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">bootloader</td>
<td align="center">自定义</td>
<td align="center">引导区</td>
</tr>
<tr>
<td align="center">data</td>
<td align="center">自定义</td>
<td align="center">数据区</td>
</tr>
<tr>
<td align="center">factory-firmware</td>
<td align="center">自定义</td>
<td align="center">出厂固件区</td>
</tr>
<tr>
<td align="center">iteration-firmware</td>
<td align="center">自定义</td>
<td align="center">迭代固件区</td>
</tr>
<tr>
<td align="center">upgrade-firmware</td>
<td align="center">自定义</td>
<td align="center">升级运行固件区</td>
</tr>
</tbody></table>
<h3 id="方式二-Bootloader-工作流程"><a href="#方式二-Bootloader-工作流程" class="headerlink" title="方式二 Bootloader 工作流程"></a>方式二 Bootloader 工作流程</h3><div class="mermaid">
graph TD;
    startup-->check_data_area;
    check_data_area-->goto_factory_fm;
    check_data_area-->goto_iteration_fm;
    check_data_area-->upgrade_flow;
    upgrade_flow-->check_iteration_fm;
    check_iteration_fm-->change_data_area;
    change_data_area-->goto_iteration_fm;
</div>

<h3 id="方式二-upgrade-工作流程"><a href="#方式二-upgrade-工作流程" class="headerlink" title="方式二 upgrade 工作流程"></a>方式二 upgrade 工作流程</h3><div class="mermaid">
graph TD;
    receive_upgrade_request-->goto_upgrade_area;
    goto_upgrade_area-->erase_iteration_area;
    erase_iteration_area-->receive_to_iteration_area;
    receive_to_iteration_area-->receive_finish;
    receive_finish-->check_iteration_area;
    check_iteration_area-->change_data_area;
    change_data_area-->response_success_or_fail;
</div>

<h3 id="方式二-总结"><a href="#方式二-总结" class="headerlink" title="方式二 总结"></a>方式二 总结</h3><p>经过验证，可以实现，但是缺点明显：</p>
<ol>
<li>任何一个过程出错，程序都将回到出厂固件。</li>
<li>在升级区，以来比较稳定的升级流程，不能跟随最新的固件更新而更新，但是同时也与应用解除耦合了。</li>
<li>需要分开编译与编写固件区与升级区，管理固件似乎不太方便。</li>
</ol>
<h2 id="方式三（参考A-B系统方式）"><a href="#方式三（参考A-B系统方式）" class="headerlink" title="方式三（参考A/B系统方式）"></a>方式三（参考A/B系统方式）</h2><h3 id="方式三-分区表"><a href="#方式三-分区表" class="headerlink" title="方式三 分区表"></a>方式三 分区表</h3><table>
<thead>
<tr>
<th align="center">分区名称</th>
<th align="center">分区大小</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">bootloader</td>
<td align="center">自定义</td>
<td align="center">引导区</td>
</tr>
<tr>
<td align="center">data</td>
<td align="center">自定义</td>
<td align="center">数据区</td>
</tr>
<tr>
<td align="center">factory-firmware</td>
<td align="center">自定义</td>
<td align="center">出厂固件区</td>
</tr>
<tr>
<td align="center">firmware-A</td>
<td align="center">自定义</td>
<td align="center">固件A区</td>
</tr>
<tr>
<td align="center">firmware-B</td>
<td align="center">自定义</td>
<td align="center">固件B区</td>
</tr>
</tbody></table>
<h3 id="方式三-Bootloader-工作流程"><a href="#方式三-Bootloader-工作流程" class="headerlink" title="方式三 Bootloader 工作流程"></a>方式三 Bootloader 工作流程</h3><div class="mermaid">
graph TD;
    startup-->check_data_area;
    check_data_area-->select_factory;
    select_factory-->goto_factory;
    check_data_area-->select_a_b_area;
    select_a_b_area-->check_a_b_valid;
    check_a_b_valid-->goto_a_b_fm;
    check_a_b_valid-->select_other_fm;
</div>

<h3 id="方式三-upgrade-工作流程"><a href="#方式三-upgrade-工作流程" class="headerlink" title="方式三 upgrade 工作流程"></a>方式三 upgrade 工作流程</h3><div class="mermaid">
graph TD;
    upgrade_flow-->response_next_run;
    response_next_run-->erase_next_run;
    erase_next_run-->receive_to_next_run;
    receive_to_next_run-->change_data_area;
</div>

<h3 id="方式三-总结"><a href="#方式三-总结" class="headerlink" title="方式三 总结"></a>方式三 总结</h3><p>参考A/B系统的升级方式，目前这种升级方式解决了以上两种方式的大部分问题，但是依然有疏漏：</p>
<ol>
<li>进入升级状态时，必须上报下次运行的分区，让发送方知道需要发送分区的固件，所以每个版本要存放两份。</li>
<li>从分区角度看，似乎出厂区的程序用处不大，除非有恢复到出厂固件的需求，不然也可以去掉了。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/02/08/v2ray-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/08/v2ray-server/" class="post-title-link" itemprop="url">v2ray Linux 服务端配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-02-08T00:00:00+00:00">2021-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>由于某种原因，所以科学上网是必不可少的，使用网上的一键搭建的脚本也可以完成，但是想自己试试。</p>
</blockquote>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.v2ray.com/en/welcome/install.html">https://www.v2ray.com/en/welcome/install.html</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">// 下载官方安装脚本</span><br><span class="line"><span class="meta">$</span><span class="bash"> wget https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh</span></span><br><span class="line"></span><br><span class="line">// 添加执行权限</span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod +x install-release.sh</span></span><br><span class="line"></span><br><span class="line">// 简单看一下脚本，可以通过 --help 查看帮助</span><br><span class="line"><span class="meta">$</span><span class="bash"> ./install-release.sh --<span class="built_in">help</span></span></span><br><span class="line">WARNING: The user currently executing this script is not root. You may encounter the insufficient privilege error.</span><br><span class="line">Are you sure you want to continue? [y/n] y</span><br><span class="line">Continuing the installation with current user...</span><br><span class="line">usage: ./install-release.sh [--remove | --version number | -c | -f | -h | -l | -p]</span><br><span class="line">  [-p address] [--version number | -c | -f]</span><br><span class="line">  --remove        Remove V2Ray</span><br><span class="line">  --version       Install the specified version of V2Ray, e.g., --version v4.18.0</span><br><span class="line">  -c, --check     Check if V2Ray can be updated</span><br><span class="line">  -f, --force     Force installation of the latest version of V2Ray</span><br><span class="line">  -h, --help      Show help</span><br><span class="line">  -l, --local     Install V2Ray from a local file</span><br><span class="line">  -p, --proxy     Download through a proxy server, e.g., -p http://127.0.0.1:8118 or -p socks5://127.0.0.1:1080</span><br><span class="line"></span><br><span class="line">// 管理员权限执行安装</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ./install-release.sh</span></span><br><span class="line">......</span><br><span class="line">// 第一次安装，所以这些服务文件是没有的，所以无法删除，正常现象</span><br><span class="line">rm: cannot remove ‘/etc/systemd/system/v2ray.service.d/10-donot_touch_multi_conf.conf’: No such file or directory</span><br><span class="line">rm: cannot remove ‘/etc/systemd/system/v2ray@.service.d/10-donot_touch_multi_conf.conf’: No such file or directory</span><br><span class="line">// 提示成功安装</span><br><span class="line">info: Systemd service files have been installed successfully!</span><br><span class="line">......</span><br><span class="line">// 提示版本比较陈旧，不管</span><br><span class="line">warning: The systemd version on the current operating system is too low.</span><br><span class="line">warning: Please consider to upgrade the systemd or the operating system.</span><br><span class="line">// 部署的文件位置</span><br><span class="line">installed: /usr/local/bin/v2ray</span><br><span class="line">installed: /usr/local/bin/v2ctl</span><br><span class="line">installed: /usr/local/share/v2ray/geoip.dat</span><br><span class="line">installed: /usr/local/share/v2ray/geosite.dat</span><br><span class="line">installed: /usr/local/etc/v2ray/config.json</span><br><span class="line">installed: /var/log/v2ray/</span><br><span class="line">installed: /var/log/v2ray/access.log</span><br><span class="line">installed: /var/log/v2ray/error.log</span><br><span class="line">installed: /etc/systemd/system/v2ray.service</span><br><span class="line">installed: /etc/systemd/system/v2ray@.service</span><br><span class="line">......</span><br><span class="line">// 不清楚为啥需要删除 curl 和 unzip，先不管</span><br><span class="line">You may need to execute a command to remove dependent software: yum remove curl unzip</span><br><span class="line">// 通过执行如下命令启动 v2ray</span><br><span class="line">Please execute the command: systemctl enable v2ray; systemctl start v2ray</span><br><span class="line"></span><br><span class="line">// 开机启动 v2ray 和 启动 v2ray</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl <span class="built_in">enable</span> v2ray</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/v2ray.service to /etc/systemd/system/v2ray.service.</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start v2ray</span></span><br><span class="line">// 查看 v2ray 服务状态</span><br><span class="line"><span class="meta">$</span><span class="bash"> systemctl status v2ray</span></span><br><span class="line">● v2ray.service - V2Ray Service</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/v2ray.service; enabled; vendor preset: disabled)</span><br><span class="line">  Drop-In: /etc/systemd/system/v2ray.service.d</span><br><span class="line">           └─10-donot_touch_single_conf.conf</span><br><span class="line">   Active: active (running) since Wed 2021-04-21 20:29:00 CST; 44s ago</span><br><span class="line">     Docs: https://www.v2fly.org/</span><br><span class="line"> Main PID: 27156 (v2ray)</span><br><span class="line">   CGroup: /system.slice/v2ray.service</span><br><span class="line">           └─27156 /usr/local/bin/v2ray -config /usr/local/etc/v2ray/config.json</span><br></pre></td></tr></table></figure>

<p>通过安装信息，有如下路径：</p>
<p>v2ray 命令路径：<code>/usr/local/bin/v2ray</code><br>配置文件路径：<code>/usr/local/etc/v2ray/config.json</code></p>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前端口状态</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo netstat -antlp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有找到 v2ray 相关端口</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件 进站端口:10086</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /usr/<span class="built_in">local</span>/etc/v2ray/config.json</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;inbounds&quot;: [&#123;</span><br><span class="line">    &quot;port&quot;: 10086, // Port of the server. Must be the same as above.</span><br><span class="line">    &quot;protocol&quot;: &quot;vmess&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">      &quot;clients&quot;: [&#123; &quot;id&quot;: &quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot; &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  &quot;outbounds&quot;: [&#123;</span><br><span class="line">    &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;&#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart v2ray</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前端口状态</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo netstat -antlp</span></span><br><span class="line">tcp6       0      0 :::10086                :::*                    LISTEN      28487/v2ray</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看服务器IP</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl cip.cc</span></span><br><span class="line">IP      : BBB.BBB.BBB.BBB</span><br></pre></td></tr></table></figure>

<h2 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 客户端没有代理前的IP</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl cip.cc</span></span><br><span class="line">IP      : AAA.AAA.AAA.AAA</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /usr/<span class="built_in">local</span>/etc/v2ray/config.json</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不贴了，参考:https://www.v2ray.com/en/welcome/start.html</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务,通过代理确认IP,成功代理</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl restart v2ray.service</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> proxychains curl cip.cc</span></span><br><span class="line">IP      : BBB.BBB.BBB.BBB</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/24/secureCRT-xfer-file-script/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/24/secureCRT-xfer-file-script/" class="post-title-link" itemprop="url">secureCRT 通过脚本发送文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-24 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-24T00:00:00+00:00">2021-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>由于一次 ECN 引发的事故，工厂生产手动的输入升级命令和选中升级文件以及校对版本实在低效，为了弥补错误，提高效率，需要实现自动化的升级。</p>
</blockquote>
<h2 id="设备手动流程"><a href="#设备手动流程" class="headerlink" title="设备手动流程"></a>设备手动流程</h2><ol>
<li>设备开机，等待输入命令</li>
<li>输入升级指令</li>
<li>选择升级文件</li>
<li>等待升级结果</li>
<li>升级完成自动重启，查看升级版本</li>
</ol>
<h2 id="设备自动升级流程"><a href="#设备自动升级流程" class="headerlink" title="设备自动升级流程"></a>设备自动升级流程</h2><ol>
<li>设备开机，每隔1s，自动发送回车等待反馈提示符</li>
<li>收到提示符确认成功通信，发送版本查询指令</li>
<li>版本校验，版本与目标版本一致，提示当前固件为最新固件</li>
<li>否则自动输入升级指令，等待接收升级文件反馈</li>
<li>收到接收升级文件反馈，发送升级文件</li>
<li>发送完成回到步骤 1，每隔1s，自动发送回车等待反馈提示符</li>
</ol>
<h2 id="secureCRT-帮助文档"><a href="#secureCRT-帮助文档" class="headerlink" title="secureCRT 帮助文档"></a>secureCRT 帮助文档</h2><ol>
<li><p>消息提示框</p>
<blockquote>
<p>Description</p>
<pre><code>  The Dialog object provides access to simple user-interface features     provided by SecureCRT.
</code></pre>
<p>Syntax</p>
<p><code>crt.Dialog.Method([arglist])</code></p>
<p>Remarks</p>
<pre><code>  SecureCRT&#39;s Dialog object is accessed through the top-level object’s    Dialog property.
</code></pre>
<p>Dialog Object Methods</p>
<pre><code>  Methods

      FileOpenDialog

      MessageBox

      Prompt
</code></pre>
<p>Methods</p>
<pre><code>  ......
</code></pre>
<p>MessageBox</p>
<p>Description</p>
<p>Display a message</p>
<p>Remarks</p>
<p>The MessageBox function displays a message string to the user. The optional   title string sets the title or caption of the MessageBox. The buttons that    appear on the MessageBox can be configured by passing a combination of numeric     values in the optional ‘buttons’ parameter. By default MessageBox will display  the message string with an OK button. However, many possibilities exist for  displaying message boxes with different icons, and buttons.</p>
<p>The MessageBox function returns a numeric value that can be used to identify  which button was clicked.</p>
<p>VBScript</p>
<p>Syntax</p>
<p><code>crt.Dialog.MessageBox(message [, title [, buttons]])</code></p>
<p>Example</p>
<p>The following code sample defines the constants that can be combined to form  the “button” parameter as well as the possible numeric return values:</p>
<p><code>result = crt.Dialog.MessageBox(&quot;Login Failed, Retry?&quot;, &quot;Error&quot;,   ICON_QUESTION Or BUTTON_YESNO Or DEFBUTTON2 )</code></p>
<p>Prompt</p>
<pre><code>  ......
</code></pre>
</blockquote>
<p> 使用方法非常简单：<code>crt.Dialog.MessageBox(&quot;字符串&quot;)</code></p>
</li>
<li><p>文件发送</p>
<blockquote>
<p>Description</p>
<pre><code>  The FileTransfer object provides methods for performing file transfers  initiated by scripts.
</code></pre>
<p>Syntax</p>
<p><code>crt.FileTransfer.Method([arglist])</code></p>
<p><code>crt.FileTransfer.Property [ = varname ]</code></p>
<p>Remarks</p>
<pre><code>  SecureCRT&#39;s FileTransfer object is accessed through the top-level   object’s FileTransfer property. The FileTransfer object is not supported with     with sessions that use TN3270 emulation.
</code></pre>
<p>FileTransfer Object Properties and Methods</p>
<pre><code>  Methods

      SendYmodem
</code></pre>
<p>SendYmodem</p>
<p>Description</p>
<pre><code>  Sends specified file.
</code></pre>
<p>Remarks</p>
<pre><code>  SendYmodem sends the specified file using the Ymodem protocol. Note,    the appropriate Ymodem receive command should be sent or initiated on the  remote system before executing SendYmodem for the transfer to begin properly.
</code></pre>
<p>Errors:</p>
<ol>
<li>If the SendYmodem method is executed while not connected the following     script error is generated:<code>&quot;FileTransfer.SendYmodem: not connected&quot;</code></li>
<li>If the file list is empty, the following script error is   generated:<code>&quot;FileTransfer.SendYmodem: No files were specified for transfer.&quot;</code></li>
<li>If a transfer is already in progress when this is called, the following    script error is generated:<code>&quot;FileTransfer.SendYmodem: A file transfer cannot  be started while another transfer is in progress&quot;</code></li>
</ol>
<p>VBScript</p>
<p>Syntax</p>
<p><code>crt.FileTransfer.SendYmodem</code></p>
<p>Example</p>
<p>‘ upload several files using Ymodem</p>
<p><code>crt.FileTransfer.AddToUploadList &quot;c:\temp\File1.txt&quot;</code></p>
<p><code>crt.FileTransfer.AddToUploadList &quot;c:\temp\File2.txt&quot;</code></p>
<p><code>crt.FileTransfer.AddToUploadList &quot;c:\temp\File3.txt&quot;</code></p>
<p><code>crt.FileTransfer.SendYmodem</code></p>
</blockquote>
<p> 使用说明：</p>
<ol>
<li>清空发送列表：<code>crt.FileTransfer.ClearUploadList</code></li>
<li>添加文件加入发送列表：<code>crt.FileTransfer.AddToUploadList 文件路径</code></li>
<li>发送文件：<code>crt.FileTransfer.SendYmodem</code></li>
</ol>
</li>
</ol>
<h2 id="脚本实例"><a href="#脚本实例" class="headerlink" title="脚本实例"></a>脚本实例</h2><pre><code><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#$language = <span class="string">&quot;VBScript&quot;</span></span><br><span class="line">#$<span class="keyword">interface</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line">crt.Screen.Synchronous = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; This automatically generated script may need to be</span></span><br><span class="line"><span class="comment">&#x27; edited in order to work correctly.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> Main</span><br><span class="line">    ` 命令行提示符</span><br><span class="line">    str_propt = <span class="string">&quot;$&quot;</span></span><br><span class="line">    ` 版本查询指令</span><br><span class="line">    cmd_version = <span class="string">&quot;version&quot;</span></span><br><span class="line">    ` 升级指令</span><br><span class="line">    cmd_upgrade = <span class="string">&quot;upgrade&quot;</span></span><br><span class="line">    ` 目标版本反馈字符串</span><br><span class="line">    last_version = <span class="string">&quot;version:1.0&quot;</span></span><br><span class="line">    ` 文件路径</span><br><span class="line">    file_path = <span class="string">&quot;C:test.bin&quot;</span></span><br><span class="line">    <span class="keyword">While</span> <span class="literal">True</span></span><br><span class="line">        crt.Screen.Send chr(<span class="number">13</span>)</span><br><span class="line">        ret = crt.Screen.WaitForString(str_propt, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">If</span> ret &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">            crt.Screen.Send cmd_version &amp; chr(<span class="number">13</span>)</span><br><span class="line">            ret = crt.Screen.WaitForString(last_version, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">If</span> ret &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">                crt.Dialog.MessageBox(<span class="string">&quot;The firmware is last version&quot;</span>)</span><br><span class="line">            <span class="keyword">Else</span></span><br><span class="line">                crt.Screen.Send cmd_upgrade &amp; chr(<span class="number">13</span>)</span><br><span class="line">                ret = crt.Screen.WaitForString(<span class="string">&quot;CCC&quot;</span>, <span class="number">10</span>)</span><br><span class="line">                <span class="keyword">If</span> ret &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">                    crt.FileTransfer.ClearUploadList</span><br><span class="line">                    crt.FileTransfer.AddToUploadList file_path</span><br><span class="line">                    crt.FileTransfer.SendYmodem</span><br><span class="line">                    ret = crt.Screen.WaitForString(last_version, <span class="number">20</span>)</span><br><span class="line">                    <span class="keyword">If</span> ret &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">                        crt.Sleep <span class="number">1000</span></span><br><span class="line">                    <span class="keyword">Else</span></span><br><span class="line">                        crt.Dialog.MessageBox(<span class="string">&quot;Upgrade fail ???&quot;</span>)</span><br><span class="line">                    <span class="keyword">End</span> <span class="keyword">if</span></span><br><span class="line">                <span class="keyword">End</span> <span class="keyword">if</span></span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">if</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">if</span></span><br><span class="line">    Wend</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/14/vim-ycm-generator-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/14/vim-ycm-generator-install/" class="post-title-link" itemprop="url">vim 插件 YCM-Generator 安装使用记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-14T00:00:00+00:00">2020-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vim/" itemprop="url" rel="index"><span itemprop="name">vim</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<figure class="highlight plaintext"><figcaption><span>是个头痛的东西，有自动生成的工具就很方便了。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim-init 项目地址：[https://github.com/Lim-LinYuanbo/vim-init](https://github.com/Lim-LinYuanbo/vim-init)</span><br><span class="line"></span><br><span class="line">YCM-Generator 项目地址：[https://github.com/rdnetto/YCM-Generator](https://github.com/rdnetto/YCM-Generator)</span><br><span class="line"></span><br><span class="line">安装测试环境：</span><br><span class="line"></span><br><span class="line">操作系统：Windows 10</span><br><span class="line"></span><br><span class="line">Linux系统：WSL Ubuntu 18.04 LTS</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## 1. 安装 YCM-Generator</span><br><span class="line"></span><br><span class="line">参考：[https://github.com/rdnetto/YCM-Generator#installation](https://github.com/rdnetto/YCM-Generator#installation)</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">$ sudo apt install python</span><br><span class="line">$ python2 --version</span><br><span class="line">Python 2.7.17</span><br><span class="line"></span><br><span class="line">$ sudo apt install clang</span><br><span class="line">$ clang --version</span><br><span class="line">clang version 6.0.0-1ubuntu2</span><br><span class="line"></span><br><span class="line">$ vi .vim/vim-init/init/init-plugins.vim</span><br><span class="line">call plug#begin(get(g:, &#x27;bundle_home&#x27;, &#x27;~/.vim/bundles&#x27;))</span><br><span class="line">...</span><br><span class="line">Plug &#x27;rdnetto/YCM-Generator&#x27;, &#123; &#x27;branch&#x27;: &#x27;stable&#x27;&#125;</span><br><span class="line">...</span><br><span class="line">call plug#end()</span><br><span class="line"></span><br><span class="line">$ vi</span><br><span class="line">:PlugInstall</span><br><span class="line">- Finishing ... Done!</span><br><span class="line">...</span><br><span class="line">- YCM-Generator: remote: Total 27 (delta 4), reused 15 (delta 0), pack-reused 0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="2-测试与使用"><a href="#2-测试与使用" class="headerlink" title="2. 测试与使用"></a>2. 测试与使用</h2><p>参考：<a target="_blank" rel="noopener" href="https://github.com/rdnetto/YCM-Generator#requirements-and-limitations">https://github.com/rdnetto/YCM-Generator#requirements-and-limitations</a></p>
<p>插件依赖 &amp; 支持系统</p>
<blockquote>
<ul>
<li><p>Requirements:</p>
<ul>
<li>Python 2</li>
<li>Clang</li>
</ul>
</li>
<li><p>Supported build systems:</p>
<ul>
<li>make</li>
<li>cmake</li>
<li>qmake</li>
<li>autotools</li>
</ul>
</li>
</ul>
</blockquote>
<p>测试工程：<a target="_blank" rel="noopener" href="https://github.com/HardySimpson/zlog">https://github.com/HardySimpson/zlog</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/HardySimpson/zlog.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> zlog/</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行命令生成 .ycm_extra_conf.py</span></span><br><span class="line">:YcmGenerateConfig</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -al .ycm_extra_conf.py</span></span><br><span class="line">-rw-r--r-- 1 ubuntu ubuntu  4890 Dec 13 17:05 .ycm_extra_conf.py</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi src/buf.c</span></span><br><span class="line">&quot;src/buf.c&quot; 649L, 17725B</span><br><span class="line">Found /home/ubuntu/zlog/.ycm_extra_conf.py. Load?</span><br><span class="line"></span><br><span class="line">(Question can be turned off with options, see YCM docs)</span><br><span class="line">[O]k, (C)ancel:</span><br><span class="line"><span class="meta">#</span><span class="bash"> 提示是否加载 .ycm_extra_conf.py ，输入 O 完成加载</span></span><br></pre></td></tr></table></figure>

<h2 id="3-其他相关"><a href="#3-其他相关" class="headerlink" title="3. 其他相关"></a>3. 其他相关</h2><p>某些工程没有 <code>make</code> 或 <code>cmake</code> 等，使用模板的或者他人提供 <code>.ycm_extra_conf.py</code> 的？</p>
<p>目前似乎没有找到什么比较合适的办法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> find .vim/bundles/YouCompleteMe/ -name <span class="string">&quot;.ycm_extra_conf.py&quot;</span></span></span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/client_data/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/driver_mode_cl/executable/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/driver_mode_cl/flag/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/general_fallback/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/get_doc/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/noflags/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clang/testdata/test-include/.ycm_extra_conf.py</span><br><span class="line">.vim/bundles/YouCompleteMe/third_party/ycmd/ycmd/tests/clangd/testdata/extra_conf/.ycm_extra_conf.py</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/13/vim-youcompleteme-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/13/vim-youcompleteme-install/" class="post-title-link" itemprop="url">vim 插件 YouCompleteMe 安装记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-13 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-13T00:00:00+00:00">2020-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vim/" itemprop="url" rel="index"><span itemprop="name">vim</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>这个插件依赖的东西挺多，而且经常遇到问题，所以重新安装一次还是需要手动记录一下。</p>
</blockquote>
<p>vim-init 项目地址：<a target="_blank" rel="noopener" href="https://github.com/Lim-LinYuanbo/vim-init">https://github.com/Lim-LinYuanbo/vim-init</a></p>
<p>YouCompleteMe 项目地址：<a target="_blank" rel="noopener" href="https://github.com/ycm-core/YouCompleteMe">https://github.com/ycm-core/YouCompleteMe</a></p>
<p>安装测试环境：</p>
<p>操作系统：Windows 10</p>
<p>Linux系统：WSL Ubuntu 18.04 LTS</p>
<hr>
<h2 id="1-安装依赖程序"><a href="#1-安装依赖程序" class="headerlink" title="1. 安装依赖程序"></a>1. 安装依赖程序</h2><p>最小系统要求：<a target="_blank" rel="noopener" href="https://github.com/ycm-core/YouCompleteMe#installation">https://github.com/ycm-core/YouCompleteMe#installation</a></p>
<blockquote>
<p>Requirements<br>Minimum supported versions:</p>
<ul>
<li>Vim v8.1.2269 huge build, compiled with Python 3.6 support (aka <code>vim-nox</code> in Ubuntu 20.04 LTS)</li>
<li>Python 3.6 runtime, compiled with <code>--enable-shared</code> (or <code>--enable-framework</code>)<br>Please note that some features are not availble in Neovim, and Neovim is not<br>officially supported.</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install python3 python3-dev</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 --version</span></span><br><span class="line">Python 3.6.9</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install vim</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim --version</span></span><br><span class="line">VIM - Vi IMproved 8.0 (2016 Sep 12, compiled Oct 13 2020 15:49:09)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 该版本过旧，需要更新最新版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo add-apt-repository ppa:jonathonf/vim</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 该过程及其缓慢，使用代理也是慢，不知为何</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 中间还失败了几次???多尝试几次似乎解决了</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install vim</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim --version</span></span><br><span class="line">VIM - Vi IMproved 8.2 (2019 Dec 12, compiled Oct 24 2020 16:26:37)</span><br></pre></td></tr></table></figure>

<p>Ubuntu依赖程序：<a target="_blank" rel="noopener" href="https://github.com/ycm-core/YouCompleteMe#linux-64-bit">https://github.com/ycm-core/YouCompleteMe#linux-64-bit</a></p>
<blockquote>
<ul>
<li><p>Ubuntu 16.04 and later:</p>
<p>sudo apt install build-essential cmake python3-dev</p>
</li>
</ul>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install build-essential cmake python3-dev</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="2-使用插件安装-YouCompleteMe"><a href="#2-使用插件安装-YouCompleteMe" class="headerlink" title="2. 使用插件安装 YouCompleteMe"></a>2. 使用插件安装 YouCompleteMe</h2><blockquote>
<p>在解决 VIM 8.0 无法使用 YouCompleteMe 的过程有人提出使用如下方式安装，并且指定使用 COMMIT ID 的 YouCompleteMe 版本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在插件安装栏中添加 Plug <span class="string">&#x27;Valloric/YouCompleteMe&#x27;</span>, &#123; <span class="string">&#x27;commit&#x27;</span>:<span class="string">&#x27;d98f896&#x27;</span> &#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定选择 commit id，否则执行安装的时候要支持更高的 C++ 版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi .vim/vim-init/init/init-plugins.vim</span></span><br><span class="line">call plug#begin(get(g:, &#x27;bundle_home&#x27;, &#x27;~/.vim/bundles&#x27;))</span><br><span class="line">...</span><br><span class="line">Plug &#x27;Valloric/YouCompleteMe&#x27;, &#123; &#x27;commit&#x27;:&#x27;d98f896&#x27; &#125;</span><br><span class="line">...</span><br><span class="line">call plug#end()</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用代理打开 Vim</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> proxychains vim</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行安装功能，如果没有使用代理，会非常慢 :(</span></span><br><span class="line">:PlugInstall</span><br><span class="line">Finishing ... Done!</span><br><span class="line">...</span><br><span class="line">- YouCompleteMe: HEAD is now at d98f896a ...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> 提示如下，通过运行 :YcmRestartServer 可以发现是说没有编译。</span></span><br><span class="line">The ycmd server SHUT DOWN (restart with &#x27;:YcmRestartServer&#x27;). Unexpected exit code 0. Type &#x27;:YcmToggleLogs ycmd_53628_stderr_a59kolj8.log&#x27; to check the logs.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译步骤，我只使用 C语言 所以添加 --clangd-completer 就行</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> .vim/bundles/YouCompleteMe/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 install.py --clangd-completer</span></span><br><span class="line">Done installing Clangd</span><br><span class="line">Clangd completer enabled. If you are using .ycm_extra_conf.py files, make sure they use Settings() instead of the old and deprecated FlagsForFile().</span><br></pre></td></tr></table></figure>

<h2 id="测试使用效果"><a href="#测试使用效果" class="headerlink" title="测试使用效果"></a>测试使用效果</h2><ol>
<li><p>关于 <code>.ycm_extra_conf.py</code> 快速解决参考：<a target="_blank" rel="noopener" href="https://github.com/ycm-core/YouCompleteMe/issues/2249">https://github.com/ycm-core/YouCompleteMe/issues/2249</a></p>
</li>
<li><p>自动生成 <code>.ycm_extra_conf.py</code> 参考：<a target="_blank" rel="noopener" href="https://github.com/rdnetto/YCM-Generator">YCM-Generator</a></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/facotry-method-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/facotry-method-pattern/" class="post-title-link" itemprop="url">工厂模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-18 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-18T00:00:00+00:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RTOS/" itemprop="url" rel="index"><span itemprop="name">RTOS</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>维基百科说明：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Factory_method_pattern">工厂方法</a></p>
<blockquote>
<p>工厂方法模式（英语：Factory method pattern）是一种实现了“工厂”概念的面向对象设计模式。就像其他创建型模式一样，它也是处理在不指定对象具体类型的情况下创建对象的问题。工厂方法模式的实质是“定义一个创建对象的接口，但让实现这个接口的类来决定实例化哪个类。工厂方法让类的实例化推迟到子类中进行。”</p>
<p>创建一个对象常常需要复杂的过程，所以不适合包含在一个复合对象中。创建对象可能会导致大量的重复代码，可能会需要复合对象访问不到的信息，也可能提供不了足够级别的抽象，还可能并不是复合对象概念的一部分。工厂方法模式通过定义一个单独的创建对象的方法来解决这些问题。由子类实现这个方法来创建具体类型的对象。</p>
<p>对象创建中的有些过程包括决定创建哪个对象、管理对象的生命周期，以及管理特定对象的创建和销毁的概念。</p>
</blockquote>
<p>参考系统：<a target="_blank" rel="noopener" href="https://gitee.com/rtthread/rt-thread">RT-Thread</a></p>
<p>参考源码版本：<a target="_blank" rel="noopener" href="https://gitee.com/rtthread/rt-thread/tree/lts-v3.1.x">lts-v3.1.x</a></p>
<hr>
<p>函数名：<code>rt_object_allocate</code></p>
<p>函数理解：工厂本身，根据传入的类型生成具体的实例</p>
<p>返回值：实例指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function will allocate an object from object system</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param type the type of object</span></span><br><span class="line"><span class="comment"> * @param name the object name. In system, the object&#x27;s name must be unique.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">rt_object_t</span> <span class="title">rt_object_allocate</span><span class="params">(<span class="keyword">enum</span> rt_object_class_type type, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_object</span> *<span class="title">object</span>;</span></span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">rt_base_t</span> temp;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_object_information</span> *<span class="title">information</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> RT_USING_MODULE</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_dlmodule</span> *<span class="title">module</span> =</span> dlmodule_self();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    RT_DEBUG_NOT_IN_INTERRUPT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* get object information */</span></span><br><span class="line">    information = rt_object_get_information(type);</span><br><span class="line">    RT_ASSERT(information != RT_NULL);</span><br><span class="line"></span><br><span class="line">    object = (struct rt_object *)RT_KERNEL_MALLOC(information-&gt;object_size);</span><br><span class="line">    <span class="keyword">if</span> (object == RT_NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* no memory can be allocated */</span></span><br><span class="line">        <span class="keyword">return</span> RT_NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* clean memory data of object */</span></span><br><span class="line">    rt_memset(object, <span class="number">0x0</span>, information-&gt;object_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* initialize object&#x27;s parameters */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set object type */</span></span><br><span class="line">    object-&gt;type = type;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* set object flag */</span></span><br><span class="line">    object-&gt;flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* copy name */</span></span><br><span class="line">    rt_strncpy(object-&gt;name, name, RT_NAME_MAX);</span><br><span class="line"></span><br><span class="line">    RT_OBJECT_HOOK_CALL(rt_object_attach_hook, (object));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* lock interrupt */</span></span><br><span class="line">    temp = rt_hw_interrupt_disable();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> RT_USING_MODULE</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">module</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        rt_list_insert_after(&amp;(<span class="keyword">module</span>-&gt;object_list), &amp;(object-&gt;<span class="built_in">list</span>));</span><br><span class="line">        object-&gt;module_id = (<span class="keyword">void</span> *)<span class="keyword">module</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* insert object into information object list */</span></span><br><span class="line">        rt_list_insert_after(&amp;(information-&gt;object_list), &amp;(object-&gt;<span class="built_in">list</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* unlock interrupt */</span></span><br><span class="line">    rt_hw_interrupt_enable(temp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* return object */</span></span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>函数名：<code>rt_thread_create</code></p>
<p>函数理解：使用工厂生成线程的实例，并初始化加入obj数组的线程链表中</p>
<p>返回值：线程类型实例指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function will create a thread object and allocate thread object memory</span></span><br><span class="line"><span class="comment"> * and stack.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param name the name of thread, which shall be unique</span></span><br><span class="line"><span class="comment"> * @param entry the entry function of thread</span></span><br><span class="line"><span class="comment"> * @param parameter the parameter of thread enter function</span></span><br><span class="line"><span class="comment"> * @param stack_size the size of thread stack</span></span><br><span class="line"><span class="comment"> * @param priority the priority of thread</span></span><br><span class="line"><span class="comment"> * @param tick the time slice if there are same priority thread</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return the created thread object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">rt_thread_t</span> <span class="title">rt_thread_create</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">void</span> (*entry)(<span class="keyword">void</span> *parameter),</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">void</span>       *parameter,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">rt_uint32_t</span> stack_size,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">rt_uint8_t</span>  priority,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">rt_uint32_t</span> tick)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_thread</span> *<span class="title">thread</span>;</span></span><br><span class="line">    <span class="keyword">void</span> *stack_start;</span><br><span class="line"></span><br><span class="line">    thread = (struct rt_thread *)rt_object_allocate(RT_Object_Class_Thread,</span><br><span class="line">                                                    name);</span><br><span class="line">    <span class="keyword">if</span> (thread == RT_NULL)</span><br><span class="line">        <span class="keyword">return</span> RT_NULL;</span><br><span class="line"></span><br><span class="line">    stack_start = (<span class="keyword">void</span> *)RT_KERNEL_MALLOC(stack_size);</span><br><span class="line">    <span class="keyword">if</span> (stack_start == RT_NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* allocate stack failure */</span></span><br><span class="line">        rt_object_delete((<span class="keyword">rt_object_t</span>)thread);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> RT_NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _rt_thread_init(thread,</span><br><span class="line">                    name,</span><br><span class="line">                    entry,</span><br><span class="line">                    parameter,</span><br><span class="line">                    stack_start,</span><br><span class="line">                    stack_size,</span><br><span class="line">                    priority,</span><br><span class="line">                    tick);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> thread;</span><br><span class="line">&#125;</span><br><span class="line">RTM_EXPORT(rt_thread_create);</span><br></pre></td></tr></table></figure>

<hr>
<p>函数名：<code>rt_timer_create</code></p>
<p>函数理解：使用工厂生成软件定时器的实例，并初始化加入obj数组的定时器链表中</p>
<p>返回值：定时器类型实例指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function will create a timer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param name the name of timer</span></span><br><span class="line"><span class="comment"> * @param timeout the timeout function</span></span><br><span class="line"><span class="comment"> * @param parameter the parameter of timeout function</span></span><br><span class="line"><span class="comment"> * @param time the tick of timer</span></span><br><span class="line"><span class="comment"> * @param flag the flag of timer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return the created timer object</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">rt_timer_t</span> <span class="title">rt_timer_create</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="keyword">void</span> (*timeout)(<span class="keyword">void</span> *parameter),</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="keyword">void</span>       *parameter,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="keyword">rt_tick_t</span>   time,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="keyword">rt_uint8_t</span>  flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_timer</span> *<span class="title">timer</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* allocate a object */</span></span><br><span class="line">    timer = (struct rt_timer *)rt_object_allocate(RT_Object_Class_Timer, name);</span><br><span class="line">    <span class="keyword">if</span> (timer == RT_NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> RT_NULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _rt_timer_init(timer, timeout, parameter, time, flag);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br><span class="line">RTM_EXPORT(rt_timer_create);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/10/rtt-cutting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/rtt-cutting/" class="post-title-link" itemprop="url">RT-Thread stable-v3.0.x 裁剪笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-10T00:00:00+00:00">2020-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RTOS/" itemprop="url" rel="index"><span itemprop="name">RTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>测试硬件平台：STM32F103ZET6（正点原子 战舰V3 开发板）</p>
<p>源码版本：RT-Thread stable-v3.0.x</p>
<p>编译环境：RT-THread 官方的 ENV，具体 GCC 版本信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> arm-none-eabi-gcc -v</span></span><br><span class="line">gcc version 5.4.1 20160919 (release) [ARM/embedded-5-branch revision 240496] (GNU Tools for ARM Embedded Processors)</span><br></pre></td></tr></table></figure>

<h3 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b test-cutting origin/stable-v3.0.x</span></span><br><span class="line">Updating files: 100% (18136/18136), done.</span><br><span class="line">Branch &#x27;test-cutting&#x27; set up to track remote branch &#x27;stable-v3.0.x&#x27; from &#x27;origin&#x27;.</span><br><span class="line">Switched to a new branch &#x27;test-cutting&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> scons</span></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line"> 177844    2708    5124  185676   2d54c rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="删除-DFS-CAN"><a href="#删除-DFS-CAN" class="headerlink" title="删除 DFS+CAN"></a>删除 DFS+CAN</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RT-Thread Components  ---&gt;</span><br><span class="line">    Device virtual file system  ---&gt;</span><br><span class="line">        [ ] Using device virtual file system</span><br><span class="line">    Device Drivers  ---&gt;</span><br><span class="line">        [ ] Using CAN device drivers</span><br><span class="line"></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">  76544    1948    3400   81892   13fe4 rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="删除-FINSH"><a href="#删除-FINSH" class="headerlink" title="删除 FINSH"></a>删除 FINSH</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">RT-Thread Components  ---&gt;</span><br><span class="line">    Command shell  ---&gt;</span><br><span class="line">        [ ] finsh shell</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> scons</span></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">  41024    1520    2180   44724    aeb4 rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="关闭组件自动初始化"><a href="#关闭组件自动初始化" class="headerlink" title="关闭组件自动初始化"></a>关闭组件自动初始化</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RT-Thread Components  ---&gt;</span><br><span class="line">    [ ] Use components automatically initialization</span><br><span class="line"></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">  34036     444    2104   36584    8ee8 rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="关闭设备模型与调试"><a href="#关闭设备模型与调试" class="headerlink" title="关闭设备模型与调试"></a>关闭设备模型与调试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">RT-Thread Kernel  ---&gt;</span><br><span class="line">    Kernel Device Object  ---&gt;</span><br><span class="line">        [ ] Using device object</span><br><span class="line">        [ ] Using console for rt_kprintf</span><br><span class="line">RT-Thread Components  ---&gt;</span><br><span class="line">    Device Drivers  ---&gt;</span><br><span class="line">        [ ] Using device drivers IPC</span><br><span class="line">        [ ] Using generic GPIO device drivers</span><br><span class="line">[ ] Enable UART1 (PA9/10)</span><br><span class="line">[ ] Enable UART2 (PA2/3)</span><br><span class="line">[ ] Enable UART3 (PB10/11)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 屏蔽 USART 的调用</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff bsp/stm32f10x/drivers/board.c</span></span><br><span class="line">-    rt_hw_usart_init();</span><br><span class="line">-    rt_console_set_device(RT_CONSOLE_DEVICE_NAME);</span><br><span class="line">+//    rt_hw_usart_init();</span><br><span class="line">+//    rt_console_set_device(RT_CONSOLE_DEVICE_NAME);</span><br><span class="line"><span class="meta">#</span><span class="bash"> 屏蔽 USART 驱动编译</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff bsp/stm32f10x/drivers/SConscript</span></span><br><span class="line">-usart.c</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使能 LED 灯用于指示程序已经正确运行</span></span><br><span class="line">-    rt_hw_usart_init();</span><br><span class="line">-    rt_console_set_device(RT_CONSOLE_DEVICE_NAME);</span><br><span class="line">+//    rt_hw_usart_init();</span><br><span class="line">+//    rt_console_set_device(RT_CONSOLE_DEVICE_NAME);</span><br><span class="line"></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">  13272     132    1716   15120    3b10 rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="关闭一些杂项，其实占用空间很小"><a href="#关闭一些杂项，其实占用空间很小" class="headerlink" title="关闭一些杂项，其实占用空间很小"></a>关闭一些杂项，其实占用空间很小</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RT-Thread Kernel  ---&gt;</span><br><span class="line">    [ ] Enable debug features</span><br><span class="line">    [ ] Enable system hook</span><br><span class="line">    Inter-Thread communication  ---&gt;</span><br><span class="line">        [ ] Enable event flag</span><br><span class="line">        [ ] Enable mailbox</span><br><span class="line">         [ ] Enable message queue</span><br><span class="line">RT-Thread Components  ---&gt;</span><br><span class="line">    POSIX layer and C standard library  ---&gt;</span><br><span class="line">        [ ] Enable libc APIs from toolchain</span><br><span class="line"></span><br><span class="line">scons: Reading SConscript files ...</span><br><span class="line">...</span><br><span class="line">LINK rtthread-stm32.elf</span><br><span class="line">arm-none-eabi-objcopy -O binary rtthread-stm32.elf rtthread.bin</span><br><span class="line">arm-none-eabi-size rtthread-stm32.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">   9912      84    1636   11632    2d70 rtthread-stm32.elf</span><br><span class="line">scons: done building targets.</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>CAN+DFS ：100KB 左右（包含驱动）</p>
<p>finsh shell ： 35KB 左右（包含命令+源码，FINSH 实际大小预计 10KB 左右）</p>
<p>components automatically initialization ： 6KB 左右</p>
<p>device &amp; driver model ： 23KB左右（包括驱动）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/21/ymodem-transmit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/21/ymodem-transmit/" class="post-title-link" itemprop="url">Xshell/secureCRT Ymodem 发送文件笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-21 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-21T00:00:00+00:00">2020-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>使用 Xshell 和 secureCRT 发送文件的时候，发相同的文件，但是效果不太一样，所以使用逻辑分析仪抓了一下波形，记录一下。</p>
</blockquote>
<h2 id="Xshell-记录"><a href="#Xshell-记录" class="headerlink" title="Xshell 记录"></a>Xshell 记录</h2><table>
<thead>
<tr>
<th align="center">Xshell</th>
<th align="center">方向</th>
<th align="center">Receiver</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">准备就绪</td>
<td align="center">无</td>
<td align="center">准备就绪</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">请求发送</td>
</tr>
<tr>
<td align="center">0x72,0x62,0x20,0x2D,0x45,0x0D</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">这是啥?字符串:rb -E\n</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">CAN</td>
<td align="center">无效数据,回复CAN,<br>或者忽略</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">超时请求发送</td>
</tr>
<tr>
<td align="center">0x01,0x00,0xFF,file_name,0x00,file_size,0x00,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">发送文件名+文件大小</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK,’C’</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">0x01,0x01,0xFE,file_data,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">文件数据</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr>
<td align="center">0x01,SEQ,~SEQ,file_data,0x1A,…,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">文件数据最后部分,不够128字节以0x1A填充</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">EOT</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">传输结束</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">NAK</td>
<td align="center">拒绝接收</td>
</tr>
<tr>
<td align="center">EOT</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">传输结束</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">超时请求发送</td>
</tr>
<tr>
<td align="center">0x01,0x00,0xFF,0x00,…,0x4F,0x4F</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">结束帧数据包,这个校验不对?<br>或者不检验这最后一桢</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">NAK</td>
<td align="center">拒绝接收,检验不通过,<br>或者直接回复ACK</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">超时请求发送,<br>或者可以直接退出了</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">Xshell传输界面依然保留,接收端超时退出,<br>或者可以直接退出了</td>
</tr>
</tbody></table>
<h2 id="SecureCRT-记录"><a href="#SecureCRT-记录" class="headerlink" title="SecureCRT 记录"></a>SecureCRT 记录</h2><table>
<thead>
<tr>
<th align="center">SecureCRT</th>
<th align="center">方向</th>
<th align="center">Receiver</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">准备就绪</td>
<td align="center">无</td>
<td align="center">准备就绪</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">请求发送</td>
</tr>
<tr>
<td align="center">0x01,0x00,0xFF,file_name,0x00,file_size,0x00,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">发送文件名+文件大小</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK,’C’</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">0x01,0x01,0xFE,file_data,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">文件数据</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
<tr>
<td align="center">0x01,SEQ,~SEQ,file_data,0x1A,…,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">文件数据最后部分,不够128字节以0x1A填充</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center">EOT</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">传输结束</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">NAK</td>
<td align="center">拒绝接收</td>
</tr>
<tr>
<td align="center">EOT</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">传输结束</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">‘C’</td>
<td align="center">超时请求发送</td>
</tr>
<tr>
<td align="center">0x01,0x00,0xFF,0x00,0x30,0x20,0x30,0x20,0x30,0x00,…,CRC,CRC</td>
<td align="center">—&gt;</td>
<td align="center"></td>
<td align="center">结束帧数据包,这不是空包?不过检验是对的,<br>解析为字符串:0 0 0</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">&lt;—</td>
<td align="center">ACK</td>
<td align="center">应答,可以直接退出了</td>
</tr>
</tbody></table>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>Xshell:开头会发一串字符串:”rb -E\n”;结束发送的空包校验值是:0x4F,0x4F,待重新确认Ymodem协议细节.</li>
<li>SecureCRT:结束发送的应该是空包,但是实际发送的数据包是一小段字符串:”0 0 0”,待重新确认Ymodem协议细节.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/cmd-tcpdump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Lin Yuanbo">
      <meta itemprop="description" content="A embedded programer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lim's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/cmd-tcpdump/" class="post-title-link" itemprop="url">tcpdump 基础使用笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-05 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-05T00:00:00+00:00">2020-09-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-06 12:23:29" itemprop="dateModified" datetime="2022-01-06T12:23:29+00:00">2022-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Tcpdump  prints  out  a  description  of the contents of packets on a network interface that match the boolean expression; the description is preceded by a time stamp, printed, by default, as hours, minutes, seconds,  and fractions of a second since midnight.</p>
<h2 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tcpdump -h</span></span><br><span class="line">tcpdump version 4.9.2</span><br><span class="line">libpcap version 1.8.1</span><br><span class="line">OpenSSL 1.1.1  11 Sep 2018</span><br><span class="line">Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX#] [ -B size ] [ -c count ]</span><br><span class="line">                [ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">                [ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">                [ -Q in|out|inout ]</span><br><span class="line">                [ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">                [ --immediate-mode ] [ -T type ] [ --version ] [ -V file ]</span><br><span class="line">                [ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">                [ -Z user ] [ expression ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><ol>
<li><p>查看当前系统状态</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前版本</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> lsb_release -a</span></span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 18.04.1 LTS</span><br><span class="line">Release:        18.04</span><br><span class="line">Codename:       bionic</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看现在查看当前网络设备状态</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ifconfig</span></span><br></pre></td></tr></table></figure></li>
<li><p>简单使用案例</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:-i 指定网卡名, -s 数据包大小(0:表示抓取整个数据包), -s 指定抓取内容写入文件名</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -s 0 -w test.cap</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:-X 以16进制呈现 -r 读取数据包名称</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -X -r test.cap</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内容略,看过TCP/IP协议的人应该都可以看懂</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:-n 不把主机的网络地址转换成名字, ip/icmp 指定抓取网络协议类型</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n ip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n icmp</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:src/dst host 113.92.130.87:数据包来源/目的 主机名 IP地址</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n host 113.92.130.87</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n src host 113.92.130.87</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n dst host 113.92.130.87</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:-n 不把主机的网络地址转换成名字, tcp 指定抓取协议类型, port 80 指定抓取端口号</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n tcp port 80</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数说明:port ! 80 表示抓取非80端口数据包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tcpdump -i eth0 -n tcp port ! 80</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li><p>wireshark 也是一款有名的图形化抓包工具,可以将抓取的数据包内容使用该软件打开</p>
</li>
<li><p>目前发现,在 WSL 下似乎无法使用 tcpdump,提示如下(目前没有解决):<code>tcpdump: socket: Socket type not supported</code></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lin Yuanbo"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Lin Yuanbo</p>
  <div class="site-description" itemprop="description">A embedded programer</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">1111111</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
